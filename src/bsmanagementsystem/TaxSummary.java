/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package bsmanagementsystem;

import DBConnect.DBconnect;
import classes.validations;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import net.proteanit.sql.DbUtils;

/**
 *
 * @author Rashan
 */
public class TaxSummary extends javax.swing.JFrame {

    /**
     * Creates new form TaxSummary
     */
    
    private String Sdate,Edate;
    private String comb,combi1;
    private final String btwn = " - ";
    private final String space = " ";
    
    public TaxSummary() {
        initComponents();
        resetTable();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jButton13 = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jDateChooser1 = new com.toedter.calendar.JDateChooser();
        jLabel5 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jDateChooser2 = new com.toedter.calendar.JDateChooser();
        jButton1 = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setMaximumSize(new java.awt.Dimension(1366, 768));
        setMinimumSize(new java.awt.Dimension(1366, 768));
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 22)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("Tax Summary");
        jLabel1.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        jLabel1.setPreferredSize(new java.awt.Dimension(200, 50));
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(59, 56, -1, -1));

        jButton13.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jButton13.setText("Back");
        jButton13.setMaximumSize(new java.awt.Dimension(188, 54));
        jButton13.setMinimumSize(new java.awt.Dimension(188, 54));
        jButton13.setPreferredSize(new java.awt.Dimension(120, 46));
        jButton13.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton13ActionPerformed(evt);
            }
        });
        getContentPane().add(jButton13, new org.netbeans.lib.awtextra.AbsoluteConstraints(1194, 48, -1, -1));

        jTable1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(jTable1);

        getContentPane().add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(510, 140, 810, 539));

        jDateChooser1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jDateChooser1.setMinimumSize(new java.awt.Dimension(216, 50));
        jDateChooser1.setPreferredSize(new java.awt.Dimension(216, 50));
        getContentPane().add(jDateChooser1, new org.netbeans.lib.awtextra.AbsoluteConstraints(246, 341, -1, -1));

        jLabel5.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel5.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel5.setText("Start");
        jLabel5.setMaximumSize(new java.awt.Dimension(188, 54));
        jLabel5.setMinimumSize(new java.awt.Dimension(188, 54));
        jLabel5.setPreferredSize(new java.awt.Dimension(188, 54));
        getContentPane().add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(119, 355, 91, 29));

        jLabel4.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel4.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel4.setText("End");
        jLabel4.setMaximumSize(new java.awt.Dimension(188, 54));
        jLabel4.setMinimumSize(new java.awt.Dimension(188, 54));
        jLabel4.setPreferredSize(new java.awt.Dimension(188, 54));
        getContentPane().add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(119, 419, 91, 29));

        jDateChooser2.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jDateChooser2.setMaximumSize(new java.awt.Dimension(105, 22));
        jDateChooser2.setMinimumSize(new java.awt.Dimension(105, 22));
        getContentPane().add(jDateChooser2, new org.netbeans.lib.awtextra.AbsoluteConstraints(246, 409, 216, 49));

        jButton1.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jButton1.setText("Show");
        jButton1.setMaximumSize(new java.awt.Dimension(188, 54));
        jButton1.setMinimumSize(new java.awt.Dimension(188, 54));
        jButton1.setPreferredSize(new java.awt.Dimension(188, 54));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        getContentPane().add(jButton1, new org.netbeans.lib.awtextra.AbsoluteConstraints(208, 558, 130, 36));

        jLabel3.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel3.setText("Period");
        getContentPane().add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(53, 191, 188, 57));

        jTextField1.setEditable(false);
        getContentPane().add(jTextField1, new org.netbeans.lib.awtextra.AbsoluteConstraints(246, 198, 216, 46));

        jLabel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/backgrnd1.png"))); // NOI18N
        getContentPane().add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1350, 720));

        setSize(new java.awt.Dimension(1366, 768));
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void jButton13ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton13ActionPerformed

        FinanceMain l2 = new FinanceMain();

        l2.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_jButton13ActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed

        try {
        Sdate = getStartDate();
        Edate = getEndDate();
        
        String m =getMonthStart();
        //String m1,m2,m3;
        String m4 = getMonthEnd();

        String dis = concat(Sdate,Edate,m,m4);
        jTextField1.setText(dis);
        
        resetTable();
        tableLoad();
        
        
        }
        catch (Exception e){
            System.out.println(e);
            //new validations().validateApproval();
        }
        
    }//GEN-LAST:event_jButton1ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(TaxSummary.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(TaxSummary.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(TaxSummary.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(TaxSummary.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(() -> {
            new TaxSummary().setVisible(true);
        });
    }
    

    
 String getEndDate()
{
   String x = this.jDateChooser2.getDate().toString();
   System.out.println(x);

   char []arr = new char[50];
   
   x.getChars(8,11,arr,0);
   x.getChars(9,12,arr,1);
   
   char y = arr[0];
   char n = arr[1];
   
   String date1 = String.valueOf(y);
   String date2 = String.valueOf(n);
   
   String date = date1.concat(date2);
   
   System.out.println(date);
   
    //filltxtFields(r,b,d);
    return date;
}
    
String getStartDate()
{
   String x = this.jDateChooser1.getDate().toString();
   System.out.println(x);

   char []arr = new char[50];
   
   x.getChars(8,11,arr,0);
   x.getChars(9,12,arr,1);
   
   char y = arr[0];
   char n = arr[1];
   
   String date1 = String.valueOf(y);
   String date2 = String.valueOf(n);
   
   String date = date1.concat(date2);
   
   System.out.println(date);
   
    //filltxtFields(r,b,d);
    return date;
}
    
    String getMonthStart(){
    
   String x = this.jDateChooser1.getDate().toString();
   System.out.println(x);

   char []arr = new char[50];
   
   x.getChars(4,7,arr,0);
   x.getChars(5,8,arr,1);
   x.getChars(6,9,arr,2);
   
   char y = arr[0];
   char n = arr[1];
   char c = arr[2];
   
   String m1 = String.valueOf(y);
   String m2 = String.valueOf(n);
   String m3 = String.valueOf(c);
   
   String mn1 = m1.concat(m2);
   String mf = mn1.concat(m3);
   
   System.out.println(mf);
   
    //filltxtFields(r,b,d);
    return mf;
}
    String getMonthEnd(){
    
   String x = this.jDateChooser2.getDate().toString();
   System.out.println(x);

   char []arr = new char[50];
   
   x.getChars(4,7,arr,0);
   x.getChars(5,8,arr,1);
   x.getChars(6,9,arr,2);
   
   char y = arr[0];
   char n = arr[1];
   char c = arr[2];
   
   String m1 = String.valueOf(y);
   String m2 = String.valueOf(n);
   String m3 = String.valueOf(c);
   
   String mn1 = m1.concat(m2);
   String mf = mn1.concat(m3);
   
   System.out.println(mf);
   
    //filltxtFields(r,b,d);
    return mf;
}
    private String getStartDateFormat(){
      
     SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
     
     String date1 = sdf.format(this.jDateChooser1.getDate());
     
     System.out.println(date1);
     
     return date1;
    }
    
    private String getEndDateFormat(){
          SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
     
     String date1 = sdf.format(this.jDateChooser2.getDate());
     
     System.out.println(date1);
      
     return date1;
    }
    
    public String concat(String Sdate,String Edate,String m,String m4){
    
        //Approval app11 = new Approval();
        
        String m1,m2,m3;
        String last;
        String cfinal;
        String Smonth;
        
        comb = Sdate; 
        combi1 = Edate;
        
        m1 = comb.concat(space);
        Smonth = m1.concat(m);
        last = Smonth.concat(btwn);
        m2 = last.concat(Edate);
        m3 = m2.concat(space);
        cfinal = m3.concat(m4);

        
        System.out.println(Sdate);
        System.out.println(Edate);
        System.out.println(comb);
        
        return cfinal;
}
 private void resetTable(){
     
     DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
     //jTable1.setModel(model);
     model.setRowCount(0);
     
 }
 
 public final void tableLoad(){
             
          String start = this.getStartDateFormat();
          String end = this.getEndDateFormat();
          
           Connection con1 = null;
       PreparedStatement pst1=null;
       con1 = DBconnect.connect();
       ResultSet rs = null;
       //int num = n.jTable1.getColumnCount();
       //int i;
       
    
        try
        {
            String s = "SELECT `ExpenseID`,`Category`,`Method`,`Approval`,`Date` FROM `adminexpenses` WHERE `Date` >= any (SELECT `Date` FROM `adminexpenses` WHERE `Date` >= '"+start+"') AND `Date` <= any (SELECT `Date` FROM `adminexpenses` WHERE `Date` <= '"+end+"') AND `Category` = any (SELECT `Category` WHERE `Category` = 'Tax')";
            pst1 = con1.prepareStatement(s);
            //pst1.execute(s);
            rs = pst1.executeQuery();
            jTable1.setModel(DbUtils.resultSetToTableModel(rs));
            JOptionPane.showMessageDialog(null,"Successfull");
            
            
        }
        
       catch(SQLException e)
                {
                    System.out.println(e);
                    JOptionPane.showMessageDialog(null,"UN-Successfull - Invalid Period of Time - Theres no data in between the selected period");
                }
        
       
          
          
           
     }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton13;
    public com.toedter.calendar.JDateChooser jDateChooser1;
    public com.toedter.calendar.JDateChooser jDateChooser2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable1;
    public javax.swing.JTextField jTextField1;
    // End of variables declaration//GEN-END:variables
}
